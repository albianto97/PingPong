<h2>Inserisci Match</h2>

<section class="card wide">

  <!-- AVVERSARIO -->
  <div class="form-group">
    <label>Avversario</label>
    <select [(ngModel)]="opponentId">
      <option value="">Seleziona</option>
      <option *ngFor="let p of players" [value]="p.id">
        {{ p.username }}
      </option>
    </select>
  </div>

  <!-- CONFIG MATCH -->
  <div class="config-row">

    <!-- FORMATO -->
    <div class="form-group">
      <label>Formato</label>
      <select [(ngModel)]="isBestOf3" (change)="updateMatchFormat()">
        <option [ngValue]="false">1 set</option>
        <option [ngValue]="true">Best of 3</option>
      </select>
    </div>

    <!-- PUNTEGGIO -->
    <div class="form-group">
      <label>Punteggio set</label>
      <select [(ngModel)]="maxPoints">
        <option [ngValue]="11">A 11</option>
        <option [ngValue]="21">A 21</option>
      </select>
    </div>

  </div>

  <!-- SCORE LIVE -->
  <p class="live-score">
    Set vinti: {{ getSetWins().p1 }} - {{ getSetWins().p2 }}
  </p>

  <!-- SET -->
  <div class="sets-container">

    <div
      *ngFor="let set of sets; let i = index"
      class="set-card"
      [class.invalid]="
        set.player1Points !== null &&
        set.player2Points !== null &&
        !isSetValid(set)
      "
    >

      <h4>Set {{ i + 1 }}</h4>

      <div class="scores">

        <!-- PLAYER 1 -->
        <div>
          <label>Tu</label>
          <input
            type="number"
            inputmode="numeric"
            min="0"
            [(ngModel)]="set.player1Points"
            (change)="checkThirdSet()"
          />
        </div>

        <!-- PLAYER 2 -->
        <div>
          <label>Avversario</label>
          <input
            type="number"
            inputmode="numeric"
            min="0"
            [(ngModel)]="set.player2Points"
            (change)="checkThirdSet()"
          />
        </div>

      </div>

      <!-- ERRORE SET -->
      <p
        class="set-error"
        *ngIf="
          set.player1Points !== null &&
          set.player2Points !== null &&
          !isSetValid(set)
        "
      >
        Punteggio non valido ({{ maxPoints }} con +2)
      </p>

    </div>
  </div>

  <!-- SUBMIT -->
  <button class="primary" (click)="submitMatch()">
    Salva match
  </button>

  <!-- MESSAGGIO GENERALE -->
  <p class="message">{{ message }}</p>

</section>
